<!--
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../styles/shared-styles.html">
<link rel="import" href="../../../bower_components/iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../../../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../../../bower_components/iron-image/iron-image.html">


<dom-module id="vc-card-list-item">
  <style include="shared-styles iron-flex iron-flex-alignment" is="custom-style">
     :host {
      display: block;
    }
    
    .test {
      @apply(--layout-horizontal);
      @apply(--layout-justified);
    }
    
    .alignLeft {
      font-size: 14px;
      font-weight: 100;
      text-align: left;
    }
    
    .alignRight {
      text-align: right;
    }   
    
    iron-image {
      height: 100%;
      width: auto;
      position: inherit;
      --iron-image-width: auto;
      --iron-image-height: 100%;
    }
    
    #textContainer {
      overflow: hidden;
    }
  </style>

  <template>

    <div id="mainContainer" class="test m-2 m-t-0 m-b-1">

      <div id="mainTextContainer" class="layout vertical whiteToolbar m-0 p-r-2">

        <div id="titleContainer" class="layout horizontal m-0 p-1">
          <h1 class="alignRight m-0">[[title]]</h1>
        </div>

        <div id="textContainer" class="alignLeft m-0 m-t-0 p-1">
          [[text]]
        </div>

      </div>

      <div id="iconContainer" class="card shadow bp-0-2 bc-default layout horizontal m-0">
        <iron-image id="icon" class="card m-0 p-0" src="[[image]]" height$="{{imheight}} m-0"></iron-image>
      </div>

    </div>
  </template>


  <script>
    Polymer({
      is: "vc-card-list-item",
      properties: {
        title: {
          type: String,
          reflectToAttribute: true
        },
        image: {
          type: String,
          reflectToAttribute: true,
          value: ""
        },
        text: {
          type: String,
          reflectToAttribute: true,
          value: ""
        },
        imheight: {
          type: Number,
          reflectToAttribute: true,
          notify: true,
          value: 0
        },
        colorvar: {
          type: String,
          value: ""
        }
      },

      setLines: function () {
        /*console.log("SETLINES");*/
        var that = this;
        var a = 0;
        var b = 0;
        var c = 0;

        var d = 0;
        var e = 0;
        var textContainerOptiWidth = 0;
        var titleContainerOptiWidth = 0;
        var mainTextContainerOptiWidth = 0;

        if (that.text != "") {
          a = that.$.textContainer.offsetWidth + 20;
          b = that.$.textContainer.offsetHeight - 8 + 21;
          c = Math.round(Math.sqrt(a * b));
          textContainerOptiWidth = c;
        }

        if (that.title != "") {
          a = that.$.titleContainer.offsetWidth + 20;
          b = that.$.titleContainer.offsetHeight - 8 + 21;
          c = Math.round(Math.sqrt(a * b));
          titleContainerOptiWidth = c;
        }

        mainTextContainerOptiWidth = Math.max(textContainerOptiWidth, titleContainerOptiWidth);
        that.$.mainTextContainer.style.width = mainTextContainerOptiWidth + "px";


        if (that.text != "") {
          d = that.$.titleContainer.offsetHeight + that.$.textContainer.offsetHeight;
        }
        else {
          d = that.$.titleContainer.offsetHeight;
          that.$.textContainer.style.height = "0px";
        }
        e = d + 6.38;
        that.$.mainTextContainer.style.height = e + "px";
        that.$.icon.style.height = d + "px";
        that.$.iconContainer.style.height = d + "px";
        that.$.mainContainer.style.height = e + "px";

        that.$.mainContainer.style.backgroundColor = that.getComputedStyleValue(that.colorvar);
        /*that.$.mainTextContainer.style.backgroundColor = that.getComputedStyleValue(that.colorvar);*/
        that.$.titleContainer.style.backgroundColor = that.getComputedStyleValue(that.colorvar);
        that.$.iconContainer.style.backgroundColor = "var(--default-border-color)";
      },


      windowResize: function () {
        /*console.log("windowResize");*/
      },

      ready: function () {
        var that = this;
        if (document.readyState != 'loading') {
          /*this.domReady();*/
        } else {
          window.addEventListener('DOMContentLoaded', function () { that.domReady(); });
        }

        window.addEventListener("resize", function () { that.windowResize(); });
        if (that.width == "") {
          that.width.width = "0px";
        }
        /*that.windowResize();*/
      },

      attached: function () {
        var that = this;
        that.setLines();
        /*that.windowResize();*/
      }
    });
  </script>
</dom-module>